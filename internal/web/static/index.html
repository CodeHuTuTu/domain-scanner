<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸŸåæ‰«æå™¨ - Domain Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .stat-card .number {
            color: #667eea;
            font-size: 2.5em;
            font-weight: bold;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }

        .scan-panel, .results-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .scan-panel h2, .results-panel h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #555;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .domain-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .domain-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .domain-item:hover {
            background: #f9f9f9;
        }

        .domain-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .domain-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-available {
            background: #10b981;
            color: white;
        }

        .badge-registered {
            background: #ef4444;
            color: white;
        }

        .domain-meta {
            font-size: 0.85em;
            color: #999;
            margin-top: 5px;
        }

        .session-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .session-item {
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .session-status {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-running {
            background: #fbbf24;
            color: white;
        }

        .status-completed {
            background: #10b981;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” åŸŸåæ‰«æå™¨</h1>
            <p>Domain Scanner - å¿«é€Ÿæ£€æŸ¥åŸŸåå¯ç”¨æ€§</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>æ€»åŸŸåæ•°</h3>
                <div class="number" id="stat-total">-</div>
            </div>
            <div class="stat-card">
                <h3>å¯ç”¨åŸŸå</h3>
                <div class="number" id="stat-available">-</div>
            </div>
            <div class="stat-card">
                <h3>å·²æ³¨å†ŒåŸŸå</h3>
                <div class="number" id="stat-registered">-</div>
            </div>
        </div>

        <div class="content-grid">
            <div class="scan-panel">
                <h2>ğŸš€ å¯åŠ¨æ‰«æ</h2>
                <form id="scan-form">
                    <div class="form-group">
                        <label>åŸŸåé•¿åº¦</label>
                        <input type="number" id="length" value="3" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label>åŸŸååç¼€</label>
                        <input type="text" id="suffix" value=".li" placeholder=".com">
                    </div>
                    <div class="form-group">
                        <label>åŸŸåæ¨¡å¼</label>
                        <select id="pattern">
                            <option value="D">çº¯å­—æ¯ (abc)</option>
                            <option value="d">çº¯æ•°å­— (123)</option>
                            <option value="a">å­—æ¯æ•°å­— (a1b)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ­£åˆ™è¿‡æ»¤ (å¯é€‰)</label>
                        <input type="text" id="regex" placeholder="^[a-z]{2}[0-9]$">
                    </div>
                    <div class="form-group">
                        <label>æŸ¥è¯¢å»¶è¿Ÿ (æ¯«ç§’)</label>
                        <input type="number" id="delay" value="1000" min="100" step="100">
                    </div>
                    <div class="form-group">
                        <label>å·¥ä½œçº¿ç¨‹æ•°</label>
                        <input type="number" id="workers" value="10" min="1" max="50">
                    </div>
                    <button type="submit" class="btn" id="scan-btn">å¼€å§‹æ‰«æ</button>
                </form>

                <h2 style="margin-top: 30px;">ğŸ“Š æ‰«æå†å²</h2>
                <div class="session-list" id="session-list">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <div class="results-panel">
                <h2>ğŸ“‹ åŸŸåç»“æœ</h2>

                <div class="tabs">
                    <button class="tab active" data-filter="all">å…¨éƒ¨</button>
                    <button class="tab" data-filter="available">å¯ç”¨</button>
                    <button class="tab" data-filter="registered">å·²æ³¨å†Œ</button>
                </div>

                <div class="search-box">
                    <input type="text" id="search-input" placeholder="æœç´¢åŸŸå...">
                </div>

                <div class="domain-list" id="domain-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        åŠ è½½åŸŸååˆ—è¡¨...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFilter = 'all';
        let searchTimeout = null;

        // Load stats
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('stat-total').textContent = data.data.total_domains || 0;
                    document.getElementById('stat-available').textContent = data.data.available_domains || 0;
                    document.getElementById('stat-registered').textContent = data.data.registered_domains || 0;
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Load domains
        async function loadDomains(filter = 'all', search = '') {
            const domainList = document.getElementById('domain-list');
            domainList.innerHTML = '<div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div>';

            try {
                let url = '/api/domains?limit=100';

                if (search) {
                    url = `/api/domains/search?q=${encodeURIComponent(search)}&limit=100`;
                }

                if (filter === 'available') {
                    url += '&available=true';
                } else if (filter === 'registered') {
                    url += '&available=false';
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.success && data.data && data.data.length > 0) {
                    domainList.innerHTML = data.data.map(domain => `
                        <div class="domain-item">
                            <div>
                                <div class="domain-name">${domain.domain}</div>
                                <div class="domain-meta">
                                    ${domain.pattern} | é•¿åº¦: ${domain.length} | ${new Date(domain.checked_at).toLocaleString('zh-CN')}
                                    ${domain.signatures && domain.signatures.length > 0 ? '<br>æ ‡è®°: ' + domain.signatures.join(', ') : ''}
                                </div>
                            </div>
                            <span class="domain-badge ${domain.available ? 'badge-available' : 'badge-registered'}">
                                ${domain.available ? 'å¯ç”¨' : 'å·²æ³¨å†Œ'}
                            </span>
                        </div>
                    `).join('');
                } else {
                    domainList.innerHTML = '<div class="empty-state"><div style="font-size: 4em;">ğŸ“­</div><p>æš‚æ— æ•°æ®</p></div>';
                }
            } catch (error) {
                console.error('Failed to load domains:', error);
                domainList.innerHTML = '<div class="empty-state"><div style="font-size: 4em;">âŒ</div><p>åŠ è½½å¤±è´¥</p></div>';
            }
        }

        // Load sessions
        async function loadSessions() {
            const sessionList = document.getElementById('session-list');

            try {
                const response = await fetch('/api/sessions?limit=10');
                const data = await response.json();

                if (data.success && data.data && data.data.length > 0) {
                    sessionList.innerHTML = data.data.map(session => `
                        <div class="session-item">
                            <div class="session-header">
                                <strong>Session #${session.id}</strong>
                                <span class="session-status status-${session.status}">${session.status === 'running' ? 'è¿è¡Œä¸­' : 'å·²å®Œæˆ'}</span>
                            </div>
                            <div style="font-size: 0.9em; color: #666;">
                                <div>æ¨¡å¼: ${session.pattern} | é•¿åº¦: ${session.length} | åç¼€: ${session.suffix}</div>
                                <div>æ€»æ•°: ${session.total_domains} | å¯ç”¨: ${session.available_count} | å·²æ³¨å†Œ: ${session.registered_count}</div>
                                <div>å¼€å§‹: ${new Date(session.started_at).toLocaleString('zh-CN')}</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    sessionList.innerHTML = '<div class="empty-state"><p>æš‚æ— æ‰«æå†å²</p></div>';
                }
            } catch (error) {
                console.error('Failed to load sessions:', error);
                sessionList.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥</p></div>';
            }
        }

        // Handle scan form submission
        document.getElementById('scan-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const btn = document.getElementById('scan-btn');
            btn.disabled = true;
            btn.textContent = 'æ‰«æä¸­...';

            const scanData = {
                length: parseInt(document.getElementById('length').value),
                suffix: document.getElementById('suffix').value,
                pattern: document.getElementById('pattern').value,
                regex_filter: document.getElementById('regex').value,
                delay: parseInt(document.getElementById('delay').value),
                workers: parseInt(document.getElementById('workers').value),
            };

            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(scanData),
                });

                const data = await response.json();

                if (data.success) {
                    alert('æ‰«æå·²å¯åŠ¨ï¼è¯·ç¨åæŸ¥çœ‹ç»“æœã€‚');
                    loadSessions();
                    // Start auto-refresh
                    setTimeout(() => {
                        loadStats();
                        loadDomains(currentFilter);
                    }, 5000);
                } else {
                    alert('æ‰«æå¯åŠ¨å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                alert('æ‰«æå¯åŠ¨å¤±è´¥: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'å¼€å§‹æ‰«æ';
            }
        });

        // Handle tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentFilter = tab.dataset.filter;
                loadDomains(currentFilter);
            });
        });

        // Handle search
        document.getElementById('search-input').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                loadDomains(currentFilter, e.target.value);
            }, 500);
        });

        // Initial load
        loadStats();
        loadDomains();
        loadSessions();

        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadStats();
            loadDomains(currentFilter);
            loadSessions();
        }, 30000);
    </script>
</body>
</html>

